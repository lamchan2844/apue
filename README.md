# apue
apue-example

## ch8

进程控制
- 创建新进程
- 执行程序
- 进程终止

### 进程标识

进程的id是唯一的，可以延迟复用

### fork
```
#include <unistd.h>
pid_t fork(void);
```
fork创建子进程，fork调用一次，返回两次，子进程返回0，父进程返回子进程id。
子进程获得父进程数据空间、堆和栈的**副本**，但是父进程和子进程并不共享这些存储空间部分，父进程和子进程共享正文段。

### vfork
1. 子进程在父进程的空间中运行，如果子进程修改数据、函数调用、或者没有掉用exec或者exit就返回可能带来未知结果。
2. vfork保证子进程先运行，在子进程调用exec或exit之后父进程才能被调度运行。


### exit
##### 进程有下面5种正常终止方式：

1. 在main函数内执行return语句。这等效于调用exit。

2. 调用exit函数。此函数有ISO C定义，其操作包括调用各终止处理程序（终止处理程序在调用atexit函数时登记），然后关闭所有标准I/O流等。

3.调用_exit或_Exit函数。ISO C定义_Exit，其目的是为进程提供一种无需运行终止处理程序或信号处理程序而终止的方法。对标准I/O流是否进行冲洗，这取决于实现。在UNIX系统中，_Exit和_exit是同义的，并不清洗标准I/O流。_exit函数由exit调用，它处理UNIX特定的细节。
在大多数UNIX系统实现中，exit（3）是标准C库中的一个函数，而_exit（2）则是一个系统调用。

4. 进程的最后一个线程在其启动例程中执行返回语句。但是，该线程的返回值不会用作进程的返回值。当最后一个线程从其启动例程返回时，该进程以终止状态0返回。

5. 进程的最后一个线程调用pthread_exit函数。在这种情况下，进程终止状态总是0，这与传送给pthread_exit的参数无关。

##### 三种异常终止方式如下：

1. 调用abort。它产生SIGABRT信号，这是下一种异常终止的特例。

2. 当进程接收到某些信号时。信号可由进程自身（例如调用abort函数）、其他进程或内核产生。

3. 最后一个线程对“取消”（cancellation）请求作出响应。按系统默认，“取消”以延迟方式发生：一个线程要求取消另一个线程，一段时间之后，目标线程终止。

**不管进程如何终止，最后都会执行内核中的同一段代码。这段代码为相应进程关闭所有打开描述符，释放它所使用的存储器等。**
该终止进程的父进程都能用wait或waitpid函数取得其终止状态。
